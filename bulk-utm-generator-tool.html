<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulk UTM Card Generator</title>
<style>
header {
      background: linear-gradient(90deg,#2563eb,#1e3a8a);
      color:white; padding: 1rem;
      text-align: center;
      height:60px;
      width: 100nv;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
h1 { margin: 0; font-size: 1.5rem; color:white; }
.container {
      width: auto; margin: 1.5rem auto; padding: 1rem;
    }

body{font-family:Arial,sans-serif;background:#f9f9f9;margin:0;padding:20px;}
.container{max-width:900px;margin-top:50px;background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,0.1);}
h1{text-align:center;color:#333;}
label{display:block;margin-top:15px;font-weight:bold;}
input[type="text"],input[type="url"],textarea{width:100%;padding:10px;margin-top:5px;border:1px solid #ccc;border-radius:5px;}
textarea{resize:vertical;height:120px;font-family:monospace;}
button{margin-top:15px;padding:6px 20px;background:#007BFF;color:#fff;border:none;border-radius:5px;cursor:pointer;}
button:hover{background:#0056b3;}
.print-cards {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* 2 cards per row on desktop */
  gap: 20px;
  margin-top: 40px;
  justify-content: center; /* center cards neatly */
  align-items: stretch;    /* make sure all cards in row have equal height */
}

.card {
  border: 1px solid #007BFF;
  background: #f8f9fa;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  font-size: 12px;
  page-break-inside: avoid;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  width: 90%;              /* shrink card width */
  max-width: 350px;        /* cap width */
  word-wrap: break-word;   /* breaks long URLs */
  margin: 0 auto;          /* center inside grid cell */
  display: flex;           /* flexbox for uniform layout */
  flex-direction: column;  /* stack elements vertically */
  justify-content: space-between; /* distribute evenly */
}

.card a {
  display: inline-block;
  word-break: break-all;  /* wrap long URLs nicely */
  font-size: 11px;
}

.card img, .card canvas {
  width: 80px; /* smaller QR code */
  margin: 5px 0;
}

.card h4 {
  margin: 5px 0;
  font-size: 13px;
}

/* Responsive behavior */
@media (max-width: 768px) {
  .print-cards {
    grid-template-columns: 1fr; /* 1 card per row on small screens */
    gap: 15px;
  }
  .card {
    width: 100%; /* full width on small devices */
    max-width: none;
  }
}

@media print {
  .print-cards {
    grid-template-columns: repeat(2, 1fr); /* force 2 per row in print */
    gap: 15px;
    justify-content: center;
  }
  .card {
    width: 90%;
    max-width: 300px;
  }
}

/* Responsive behavior */
@media (max-width: 768px) {
  .print-cards {
    grid-template-columns: 1fr; /* 1 card per row on small screens */
    gap: 15px;
  }
  .card {
    width: 100%; /* full width on small devices */
    max-width: none;
  }
}

@media print {
  .print-cards {
    grid-template-columns: repeat(2, 1fr); /* force 2 per row in print */
    gap: 15px;
    justify-content: center;
  }
  .card {
    width: 90%;
    max-width: 300px;
  }
}

/* Responsive behavior */
@media (max-width: 768px) {
  .print-cards {
    grid-template-columns: 1fr; /* 1 card per row on small screens */
    gap: 15px;
  }
}

@media print {
  .print-cards {
    grid-template-columns: repeat(2, 1fr); /* force 2 per row in print */
    gap: 15px;
    justify-content: center;
  }
}
.card img{width:50px;margin:5px 0;}
.card h4{margin:5px 0;font-size:12px;}
.utm-param{background:#ffd966;padding:2px 4px;border-radius:3px;margin-right:2px;}
@media print{
body{margin:0;}
.container{box-shadow:none;}
.print-cards {  display: grid;  grid-template-columns: repeat(2, 1fr); gap: 20px;  margin-top: 20px;}
.card{page-break-inside:avoid;}
button,input,textarea{display:none;}
}
</style>
</head>

<body>
<header>
<a href="index.html"><button style="float:right;margin-right:5px;">Home</button></a>
<h1> Bulk UTM Cards Generator</h1>
</header>

<div class="container">
<label for="baseUrl">Base URL</label>
<input type="url" id="baseUrl" placeholder="https://www.example.com/page">

<label for="bulkInput">Bulk Campaigns (CSV or Tab-delimited)</label>
<textarea id="bulkInput" placeholder="utm_source,utm_medium,utm_campaign,utm_term,utm_content
facebook,cpc,spring_sale,running+shoes,header_link
instagram,email,summer_sale,sneakers,footer_link"></textarea>

<button onclick="generateBulkCards()">Generate Bulk Cards</button>
<button id="exportBtn" onclick="exportURLMap()" style="display:none;">Export urlMap.js</button>

<div style="float:left;margin-left:20px;" class="print-cards" id="printCards"></div>
<button onclick="window.print()">Print All Cards</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
const printCardsDiv = document.getElementById('printCards');
const exportBtn = document.getElementById('exportBtn');
let urlMap = {}; 
let counter = 1;

function base62Encode(num){
    const chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
    let str="";
    while(num>0){ str = chars[num % 62] + str; num=Math.floor(num/62); }
    return str || "0";
}

function generateShortCode(longUrl){
    const code = base62Encode(counter++);
    urlMap[code] = longUrl;
    return code;
}

function generateBulkCards(){
    const baseUrl=document.getElementById('baseUrl').value.trim();
    const bulkData=document.getElementById('bulkInput').value.trim();
    if(!baseUrl) return alert("Enter base URL first.");
    if(!bulkData) return alert("Enter bulk campaign data.");

    printCardsDiv.innerHTML="";
    urlMap = {}; counter = 1;
    exportBtn.style.display = "none";

    const lines=bulkData.split('\n').filter(line=>line.trim()!=='');
    lines.forEach((line,index)=>{
        const parts=line.split(/,|\t/);
        const [utmSource,utmMedium,utmCampaign,utmTerm,utmContent]=parts;
        const params=new URLSearchParams();
        if(utmSource) params.append('utm_source',utmSource.trim());
        if(utmMedium) params.append('utm_medium',utmMedium.trim());
        if(utmCampaign) params.append('utm_campaign',utmCampaign.trim());
        if(utmTerm) params.append('utm_term',utmTerm.trim());
        if(utmContent) params.append('utm_content',utmContent.trim());

        const fullUrl = `${baseUrl}?${params.toString()}`;
        const shortCode = generateShortCode(fullUrl);
        const shortUrl = `${location.origin}/s/index.html?code=${shortCode}`;

        const paramHTML = params.toString().split('&').map(p=>`<span class="utm-param">${p}</span>`).join('&');
        const cardDiv=document.createElement('div');
        cardDiv.className='card';
        cardDiv.innerHTML=`
            <h4>UTM Card ${index+1}</h4>
            <p><strong>Short URL:</strong><br><a href="${shortUrl}" target="_blank">${shortUrl}</a></p>
            <p><strong>Preview:</strong><br>${paramHTML}</p>
            <canvas id="qr${index}"></canvas>
        `;
        printCardsDiv.appendChild(cardDiv);
        QRCode.toCanvas(document.getElementById(`qr${index}`), shortUrl, {width:100}, err=>{if(err)console.error(err);});
    });
    exportBtn.style.display = "inline-block";
    alert("Cards generated! Click 'Export urlMap.js' to create redirect map.");
}

function exportURLMap(){
    if(Object.keys(urlMap).length===0) return alert("No URL map available. Generate cards first.");
    const content = "const urlMap = "+JSON.stringify(urlMap,null,4)+";\n\nexport default urlMap;";
    const blob = new Blob([content],{type:"text/javascript"});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = "urlMap.js";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    alert("urlMap.js exported! Place in /s/ folder.");
}
</script>
</body>
</html>
